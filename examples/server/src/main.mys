from fiber import sleep
from websocket.server import Server

def main():
    server = Server()
    server.listen(20000)

    while True:
        print("Waiting for a client to connect.")
        client = server.accept()
        print("Client connected.")

        for i in range(20):
            if not client.is_connected():
                break

            client.send_text(f"Message {i}")
            sleep(1.0)

        client.send_text("Done!")
